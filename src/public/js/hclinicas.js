$("#a").click(function () {
   $('#motivo').css('visibility','visible');  
   $('#actual').css('visibility','hidden');
   $('#antecedentes').css('visibility','hidden');
   $('#fisico').css('visibility','hidden');
   $('#clinico').css('visibility','hidden');
   $('#plan').css('visibility','hidden');
   $('#terapeutico').css('visibility','hidden');
   $('#impdiag').css('visibility','hidden');
   $('#ordenes').css('visibility','hidden');
   
   $('#a').css('background-color','#D2F1ED');
   $('#b').css('background-color','');
   $('#c').css('background-color','');
   $('#d').css('background-color','');
   $('#e').css('background-color','');
   $('#f').css('background-color','');
   $('#g').css('background-color','');
   $('#h').css('background-color','');
   $('#i').css('background-color','');
});
$("#b").click(function () {
   $('#motivo').css('visibility','hidden');
   $('#actual').css('visibility','visible');
   $('#antecedentes').css('visibility','hidden');
   $('#fisico').css('visibility','hidden');
   $('#clinico').css('visibility','hidden');
   $('#plan').css('visibility','hidden');
   $('#terapeutico').css('visibility','hidden');
   $('#impdiag').css('visibility','hidden');
   $('#ordenes').css('visibility','hidden');

   $('#a').css('background-color','');
   $('#b').css('background-color','#D2F1ED');
   $('#c').css('background-color','');
   $('#d').css('background-color','');
   $('#e').css('background-color','');
   $('#f').css('background-color','');
   $('#g').css('background-color','');
   $('#h').css('background-color','');
   $('#i').css('background-color','');
});
$("#c").click(function () {
    $('#motivo').css('visibility','hidden');
    $('#actual').css('visibility','hidden');
    $('#antecedentes').css('visibility','visible');
    $('#fisico').css('visibility','hidden');
    $('#clinico').css('visibility','hidden');
    $('#plan').css('visibility','hidden');
    $('#terapeutico').css('visibility','hidden');
   $('#ordenes').css('visibility','hidden');
   $('#impdiag').css('visibility','hidden');

    $('#a').css('background-color','');
    $('#b').css('background-color','');
    $('#c').css('background-color','#D2F1ED');
    $('#d').css('background-color','');
    $('#e').css('background-color','');
    $('#f').css('background-color','');
    $('#g').css('background-color','');
    $('#h').css('background-color','');
    $('#i').css('background-color','');
});
$("#d").click(function () {
    $('#motivo').css('visibility','hidden');
    $('#actual').css('visibility','hidden');
    $('#antecedentes').css('visibility','hidden');
    $('#fisico').css('visibility','visible');
    $('#clinico').css('visibility','hidden');
    $('#plan').css('visibility','hidden');
    $('#terapeutico').css('visibility','hidden');
   $('#ordenes').css('visibility','hidden');
   $('#impdiag').css('visibility','hidden');

    $('#a').css('background-color','');
    $('#b').css('background-color','');
    $('#c').css('background-color','');
    $('#d').css('background-color','#D2F1ED');
    $('#e').css('background-color','');
    $('#f').css('background-color','');
    $('#g').css('background-color','');
    $('#h').css('background-color','');
    $('#i').css('background-color','');
});
$("#e").click(function () {
    $('#motivo').css('visibility','hidden');
    $('#actual').css('visibility','hidden');
    $('#antecedentes').css('visibility','hidden');
    $('#fisico').css('visibility','hidden');
    $('#clinico').css('visibility','visible');
    $('#plan').css('visibility','hidden');
    $('#terapeutico').css('visibility','hidden');
   $('#ordenes').css('visibility','hidden');
   $('#impdiag').css('visibility','hidden');

    $('#a').css('background-color','');
    $('#b').css('background-color','');
    $('#c').css('background-color','');
    $('#d').css('background-color','');
    $('#e').css('background-color','#D2F1ED');
    $('#f').css('background-color','');
    $('#g').css('background-color','');
    $('#h').css('background-color','');
    $('#i').css('background-color','');
});
$("#f").click(function () {
    $('#motivo').css('visibility','hidden');
    $('#actual').css('visibility','hidden');
    $('#antecedentes').css('visibility','hidden');
    $('#fisico').css('visibility','hidden');
    $('#clinico').css('visibility','hidden');
    $('#plan').css('visibility','visible');
    $('#terapeutico').css('visibility','hidden');
   $('#ordenes').css('visibility','hidden');
   $('#impdiag').css('visibility','hidden');

    $('#a').css('background-color','');
    $('#b').css('background-color','');
    $('#c').css('background-color','');
    $('#d').css('background-color','');
    $('#e').css('background-color','');
    $('#f').css('background-color','#D2F1ED');
    $('#g').css('background-color','');
    $('#h').css('background-color','');
    $('#i').css('background-color','');
});
$("#g").click(function () {
    $('#motivo').css('visibility','hidden');
    $('#actual').css('visibility','hidden');
    $('#antecedentes').css('visibility','hidden');
    $('#fisico').css('visibility','hidden');
    $('#clinico').css('visibility','hidden');
    $('#plan').css('visibility','hidden');
    $('#terapeutico').css('visibility','visible');
   $('#ordenes').css('visibility','hidden');
   $('#impdiag').css('visibility','hidden');

    $('#a').css('background-color','');
    $('#b').css('background-color','');
    $('#c').css('background-color','');
    $('#d').css('background-color','');
    $('#e').css('background-color','');
    $('#f').css('background-color','');
    $('#h').css('background-color','');
    $('#g').css('background-color','#D2F1ED');
    $('#i').css('background-color','');
});

$("#h").click(function () {
    $('#motivo').css('visibility','hidden');
    $('#actual').css('visibility','hidden');
    $('#antecedentes').css('visibility','hidden');
    $('#fisico').css('visibility','hidden');
    $('#clinico').css('visibility','hidden');
    $('#plan').css('visibility','hidden');
    $('#terapeutico').css('visibility','hidden');
   $('#ordenes').css('visibility','hidden');
   $('#impdiag').css('visibility','visible');

    $('#a').css('background-color','');
    $('#b').css('background-color','');
    $('#c').css('background-color','');
    $('#d').css('background-color','');
    $('#e').css('background-color','');
    $('#f').css('background-color','');
    $('#g').css('background-color','');
    $('#h').css('background-color','#D2F1ED');
    $('#i').css('background-color','');
});

$("#i").click(function () {
    $('#motivo').css('visibility','hidden');
    $('#actual').css('visibility','hidden');
    $('#antecedentes').css('visibility','hidden');
    $('#fisico').css('visibility','hidden');
    $('#clinico').css('visibility','hidden');
    $('#plan').css('visibility','hidden');
    $('#terapeutico').css('visibility','hidden');
   $('#ordenes').css('visibility','visible');
   $('#impdiag').css('visibility','hidden');

    $('#a').css('background-color','');
    $('#b').css('background-color','');
    $('#c').css('background-color','');
    $('#d').css('background-color','');
    $('#e').css('background-color','');
    $('#f').css('background-color','');
    $('#g').css('background-color','');
    $('#h').css('background-color','');
    $('#i').css('background-color','#D2F1ED');
});

function colocarHc(hc){    
    $.ajax({
        url: '/colocarhc',
        type: 'POST',
        datatype: 'json',
        data: {
            codigo: hc
        },           
        success: (data) => {
          console.log(data);
          $('#motivo').val(data.motivo);
          $('#actual').val(data.actual);
          $('#clinico').val(data.clinico);
          $('#plan').val(data.plan);
        //   $('#receta').val(data.terapeutico);
          $('#ord').val(data.ordenes);
          $('#nariz').val(data.fisico[0].nariz);
          $('#boca').val(data.fisico[0].boca);
          $('#orofaringe').val(data.fisico[0].orofaringe);
          $('#cuello').val(data.fisico[0].cuello);
          $('#laringoscopia').val(data.fisico[0].laringoscopia);
          $('#oido').val(data.fisico[0].oido);
          $('#dg').val(data.impDiagnostico[0].diag +' :: '+data.impDiagnostico[0].nombre);
          $('#otrosfisico').val(data.fisico[0].otrosfisico);
          $('#recetaJson').val(JSON.stringify(data.receta));         
          var cadena=`<table class="table"><tbody> `;
          receta=data.receta;
          receta.forEach(element => {
              cadena+=`                                
                  <tr>
                      <th scope="row">${element.medicamento}</th>
                      <td>${element.cantidad}</td>
                      <td>${element.uso}</td>
                  </tr>
              `;
          });
          cadena+=`</tbody></table>`
          $('#vreseta').html(cadena);
        }
    });  
}

function ImprimirHc() {

  var ventana = window.open('', 'PRINT', 'height=400,width=600');
  ventana.document.write('<html><head><title>' + document.title + '</title>');
  ventana.document.write('<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"     integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">'); //Aquí agregué la hoja de estilos
  ventana.document.write('</head><body >');
  ventana.document.write($('#imp').html());
  ventana.document.write('</body></html>');
  ventana.document.close();
  ventana.focus();
  ventana.onload = function() {
    ventana.print();
    ventana.close();
  };
  return true;
}

function normalFisico() {
    $('#nariz').val('Pirámide nasal estable, dorso central. Mucosa nasal sana, septum funcional, cornetes eutróficos');
    $('#boca').val('Mucosa oral húmeda, lengua móvil, sin lesiones. Piso de boca de aspecto normal');
    $('#orofaringe').val('Paladar blando íntegro, móvil. Amígdalas sin lesiones');
    $('#laringoscopia').val('Base de lengua sana, valléculas libres, epiglotis normal. Cuerdas vocales móviles, sin lesiones. Senos piriformes de aspecto normal');
    $('#oidoderecho').val('Conducto auditivo permeable sin signos patológicos.  Membrana timpánica integra, como dé luz presente');
    $('#oidoIzquierdo').val('Conducto auditivo permeable sin signos patológicos.  Membrana timpánica integra, como dé luz presente');
    $('#cuello').val('No se palpan masas ni adenomegalias.');
    $('#otrosfisico').val('sin otro hallazgo fisico.');    
}

function validarhc() {
    if ($('#motivo').val()=="") {
        $('#msg').html(`<div class="alert alert-warning alert-dismissible fade show" role="alert">
        <strong>Alerta: </strong>Debe llenar el campo de <b>Motivo de consulta</b>
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>`);     
    }else if ($('#actual').val()=="") {
        $('#msg').html(`<div class="alert alert-warning alert-dismissible fade show" role="alert">
        <strong>Alerta: </strong>Debe llenar el campo de <b>Enferedad Actual</b>
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>`);     
    } else if ($('#clinico').val()=="") {
        $('#msg').html(`<div class="alert alert-warning alert-dismissible fade show" role="alert">
        <strong>Alerta: </strong>Debe llenar el campo de <b>Paraclinicos</b>
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>`);     
    }else if ($('#plan').val()=="") {
        $('#msg').html(`<div class="alert alert-warning alert-dismissible fade show" role="alert">
        <strong>Alerta: </strong>Debe llenar el campo de <b>Plan</b>
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>`);     
    }else if ($('#dg').val()=="") {
        $('#msg').html(`<div class="alert alert-warning alert-dismissible fade show" role="alert">
        <strong>Alerta: </strong>Debe llenar el campo de <b>Debe colocar un diagnostico principal</b>
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>`)
    }else if ($('#ccups').val()!="") {
      alert('Tiene un item en Orden  sin agregar');
    }else if ($('#medicamento').val()!="") {
      alert('Tiene un Medicamento en Receta sin agregar');
    }else{
      if(confirm("Desea guardar la historia clinica ?")){
          $('#hcform').submit();
      }
     
    }
   
}


function guardadoAlert() {
  alert('se guardo la cita');
}

function consultarPacienteporId(){

  $.ajax({
    url: '/ajax_consultarpacientes',
    type: 'POST',
    datatype: 'json',
    data: {
        cc:$('#cc').val()
    },
    success: (data) => {
      var cadena=` <tr>
        <th scope="row" class="small">${data.cedula}</th>
        <td class="small">${data.nombre} ${data.snombre} ${data.apellido} ${data.sapellido}</td>
        <td class="small">${data.telefono}</td>
        <td class="small">${data.direccion}</td>
        <td>
            <a href="/verhc/${data.cedula}" class="btn btn-primary btn-sm"><i class='fas fa-h-square' style='font-size:16px'></i></a>
            <button type="button" class="btn btn-info btn-sm" data-toggle="modal"
            data-target="#exampleModal" onclick="MostarUpdatePaciente('${data.cedula}')"><i class='far fa-edit'  style='font-size:16px'></i></button>
        </td>
    </tr>`;
     
      $('#cuerpo').html(cadena)
    }
});
}

ordernesArray=[];
function ordenes() {
  if ($('#ccups').val() == "") {
    alert('seleccione algun procedimiento')
  } else {
    ordernesArray.push({ orden: $('#ccups').val() });
    $('#ccups').val('');
    mostarOrdenes();
  }

}

function mostarOrdenes() {
  var cadena='';
  $('#ord').val(JSON.stringify(ordernesArray));
  for (let index = 0; index < ordernesArray.length; index++) {
    cadena+=`
    <div class="row"> 
      <div class="col-sm-1">${index}</div>
      <div class="col-sm-7">${ordernesArray[index].orden}</div>
      <div class="col-sm-4"><a href="#" onclick="quitarOrdenes(${index})">quitar</a></div>
    </div>`;    
  }
  $('#contenido_ordenes').html(cadena);
}



function quitarOrdenes(id) {
  ordernesArray.splice(id,1);
  mostarOrdenes();
}

function pr(valor){
 $('#pr').html(valor);
}


function enviarEmail() {  
  $.ajax({
      url: '/mail',
      type: 'POST',
      datatype: 'json', 
      data:{
        contenido:$('#idhc').val(),
        mail: $('#mail').val()
      },                 
      success: (data) => {           
        if(data=='0'){
          $('#msges').html(`<div class="alert alert-danger alert-dismissible fade show" role="alert">
          <strong>Mensaje: </strong> Hubo probmelas para enviar el correo
          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>`);
        } 
         if(data=='1'){
          $('#msges').html(`<div class="alert alert-success alert-dismissible fade show" role="alert">
          <strong>Mensaje: </strong> Tu correo fue enviado sin problemas
          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>`);
        }  
      }
  }); 
}

function enviarID(id) {
  $('#idhc').val(id);
}